<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kalkulator Umur & Kamera Filter</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      color: white;
      text-align: center;
      overflow-x: hidden;
      background: linear-gradient(135deg, #1e3c72, #2a5298, #4b0082, #1c1c1c);
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
      position: relative;
      min-height: 100vh;
      overflow: hidden;
    }

    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* Efek Asap */
    .smoke {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none;
      z-index: 1;
      opacity: 0.1;
      background-image: 
        radial-gradient(circle at 20% 30%, rgba(255,255,255,0.2) 0%, transparent 40%),
        radial-gradient(circle at 80% 60%, rgba(255,255,255,0.15) 0%, transparent 50%),
        radial-gradient(circle at 50% 80%, rgba(255,255,255,0.1) 0%, transparent 60%);
      animation: smokeMove 20s infinite alternate;
    }

    @keyframes smokeMove {
      0% { transform: translate(0, 0) scale(1); }
      100% { transform: translate(5%, 5%) scale(1.1); }
    }

    /* Efek Bintang Jatuh */
    .shooting-star {
      position: fixed;
      top: -10%;
      z-index: 1;
      width: 4px;
      height: 4px;
      background: white;
      border-radius: 50%;
      box-shadow: 0 0 8px 1px white;
      opacity: 0;
    }

    /* Halaman */
    .page {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      opacity: 1;
      transform: translateX(0);
      transition: opacity 0.6s ease, transform 0.6s ease;
      z-index: 2;
    }
    .hidden {
      opacity: 0;
      transform: translateX(-100%);
      pointer-events: none;
    }

    /* Halaman 1 */
    .welcome-container input {
      padding: 10px;
      border-radius: 8px;
      border: none;
      margin-top: 10px;
      font-size: 18px;
      text-align: center;
      width: 200px;
    }
    .welcome-container button {
      margin-top: 15px;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      background: #ff9800;
      color: #fff;
      font-size: 16px;
      cursor: pointer;
    }

    /* Halaman 2 */
    .container {
      max-width: 400px;
      background: rgba(255, 255, 255, 0.12);
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.4);
      z-index: 2;
    }
    select, input {
      width: 90%;
      padding: 10px;
      margin: 8px 0;
      border-radius: 8px;
      border: none;
      text-align: center;
      font-size: 16px;
    }
    button {
      margin-top: 10px;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      background: #ff9800;
      color: #fff;
      cursor: pointer;
    }
    .result { margin-top: 10px; font-size: 18px; }
    .zodiak {
      font-weight: bold;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-top: 5px;
    }

    /* Kamera */
    .video-container {
      position: relative;
      display: inline-block;
      width: 90%;
      max-width: 280px;
      margin-top: 15px;
    }
    video, canvas {
      width: 100%;
      border-radius: 15px;
      border: 4px solid rgba(255,255,255,0.5);
      box-shadow: 0 0 15px rgba(0,0,0,0.4);
    }
    .overlay-filter {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none;
    }
    .filter-btn {
      margin: 5px;
      padding: 6px 12px;
      border: none;
      border-radius: 8px;
      background: rgba(255,255,255,0.2);
      color: #fff;
      cursor: pointer;
    }
  </style>
</head>
<body>

<!-- Efek Asap -->
<div class="smoke"></div>

<!-- Halaman 1 -->
<div class="page" id="welcomePage">
  <div class="welcome-container">
    <h1>Selamat Datang!</h1>
    <p>Masukkan nama Anda:</p>
    <input type="text" id="username" placeholder="Nama Anda">
    <br>
    <button onclick="goToMain()">Lanjut</button>
  </div>
</div>

<!-- Halaman 2 -->
<div class="page hidden" id="mainPage">
  <div class="container">
    <h2 id="greeting">Halo!</h2>
    <select id="tanggal"></select>
    <select id="bulan"></select>
    <input type="number" id="tahun" placeholder="Masukkan tahun lahir">
    <div class="result" id="hasil"></div>
    <div class="zodiak" id="zodiakNama"></div>

    <!-- Kamera -->
    <div class="video-container">
      <video id="video" autoplay playsinline muted></video>
      <canvas id="overlay" class="overlay-filter"></canvas>
    </div><br>
    <button onclick="switchCamera()">üîÑ Ganti Kamera</button>
    <div>
      <button class="filter-btn" onclick="changeFilter('cat')">üê± Telinga Kucing</button>
      <button class="filter-btn" onclick="changeFilter('glasses')">üëì Kacamata</button>
      <button class="filter-btn" onclick="changeFilter('none')">‚ùå Hapus Filter</button>
    </div>
    <button style="margin-top:15px;background:#666" onclick="backToWelcome()">‚¨Ö Kembali</button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2"></script>
<script>
  // === Navigasi Halaman ===
  const welcomePage = document.getElementById("welcomePage");
  const mainPage = document.getElementById("mainPage");
  const greeting = document.getElementById("greeting");

  function goToMain() {
    const name = document.getElementById("username").value.trim();
    if (name === "") {
      alert("Masukkan nama terlebih dahulu!");
      return;
    }
    greeting.textContent = `Halo, ${name}! üåü`;
    welcomePage.classList.add("hidden");
    setTimeout(() => mainPage.classList.remove("hidden"), 300);
  }

  function backToWelcome() {
    mainPage.classList.add("hidden");
    setTimeout(() => welcomePage.classList.remove("hidden"), 300);
  }

  // === Dropdown Tanggal & Bulan ===
  const tanggalSelect = document.getElementById("tanggal");
  const bulanSelect = document.getElementById("bulan");
  const tahunInput = document.getElementById("tahun");
  const hasilDiv = document.getElementById("hasil");
  const zodiakNama = document.getElementById("zodiakNama");

  for (let i = 1; i <= 31; i++) {
    tanggalSelect.innerHTML += `<option value="${i}">${i}</option>`;
  }

  const bulanNama = ["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"];
  bulanNama.forEach((b, i) => {
    bulanSelect.innerHTML += `<option value="${i + 1}">${b}</option>`;
  });

  const simbolZodiak = {
    Aquarius:"‚ôí", Pisces:"‚ôì", Aries:"‚ôà", Taurus:"‚ôâ", Gemini:"‚ôä", Cancer:"‚ôã",
    Leo:"‚ôå", Virgo:"‚ôç", Libra:"‚ôé", Scorpio:"‚ôè", Sagitarius:"‚ôê", Capricorn:"‚ôë"
  };

  function hitung() {
    const t = parseInt(tanggalSelect.value);
    const b = parseInt(bulanSelect.value);
    const th = parseInt(tahunInput.value);

    if (!t || !b || !th || th < 1000) {
      hasilDiv.innerHTML = "Lengkapi data lahir!";
      zodiakNama.innerHTML = "";
      return;
    }

    const lahir = new Date(th, b - 1, t);
    const today = new Date();
    let umur = today.getFullYear() - lahir.getFullYear();

    if (today.getMonth() < lahir.getMonth() || 
        (today.getMonth() === lahir.getMonth() && today.getDate() < lahir.getDate())) {
      umur--;
    }

    const hariNama = ["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"];
    const hariLahir = hariNama[lahir.getDay()];
    const zodiak = getZodiak(t, b);

    hasilDiv.innerHTML = `Umurmu: ${umur} tahun<br>Hari Lahir: ${hariLahir}`;
    zodiakNama.innerHTML = `<img src="https://upload.wikimedia.org/wikipedia/commons/f/f0/${zodiak}_symbol.png" style="width:28px;height:28px;"> ${zodiak} ${simbolZodiak[zodiak]}`;
  }

  function getZodiak(t, b) {
    if ((b === 1 && t >= 20) || (b === 2 && t <= 18)) return "Aquarius";
    if ((b === 2 && t >= 19) || (b === 3 && t <= 20)) return "Pisces";
    if ((b === 3 && t >= 21) || (b === 4 && t <= 19)) return "Aries";
    if ((b === 4 && t >= 20) || (b === 5 && t <= 20)) return "Taurus";
    if ((b === 5 && t >= 21) || (b === 6 && t <= 20)) return "Gemini";
    if ((b === 6 && t >= 21) || (b === 7 && t <= 22)) return "Cancer";
    if ((b === 7 && t >= 23) || (b === 8 && t <= 22)) return "Leo";
    if ((b === 8 && t >= 23) || (b === 9 && t <= 22)) return "Virgo";
    if ((b === 9 && t >= 23) || (b === 10 && t <= 22)) return "Libra";
    if ((b === 10 && t >= 23) || (b === 11 && t <= 21)) return "Scorpio";
    if ((b === 11 && t >= 22) || (b === 12 && t <= 21)) return "Sagitarius";
    return "Capricorn";
  }

  tanggalSelect.addEventListener("change", hitung);
  bulanSelect.addEventListener("change", hitung);
  tahunInput.addEventListener("input", hitung);

  // === Kamera & Filter ===
  let currentStream = null;
  let usingFront = true;
  let currentFilter = 'none';
  const video = document.getElementById("video");
  const overlay = document.getElementById("overlay");
  const ctx = overlay.getContext("2d");
  let animationId = null;

  async function startCamera() {
    try {
      if (currentStream) {
        currentStream.getTracks().forEach(track => track.stop());
      }
      const constraints = {
        video: {
          facingMode: usingFront ? "user" : "environment",
          width: { ideal: 480 },
          height: { ideal: 640 }
        }
      };
      currentStream = await navigator.mediaDevices.getUserMedia(constraints);
      video.srcObject = currentStream;

      // Tunggu metadata video sebelum deteksi
      video.onloadedmetadata = () => {
        overlay.width = video.videoWidth || 480;
        overlay.height = video.videoHeight || 640;
        startDetection();
      };
    } catch (e) {
      console.error("Kamera gagal:", e);
      alert("Gagal akses kamera! Pastikan izin diberikan dan buka via HTTPS.");
    }
  }

  function switchCamera() {
    usingFront = !usingFront;
    startCamera();
  }

  function changeFilter(type) {
    currentFilter = type;
  }

  async function startDetection() {
    if (animationId) cancelAnimationFrame(animationId);
    detectFace();
  }

  async function detectFace() {
    if (!video || !video.srcObject || video.readyState !== 4) {
      animationId = requestAnimationFrame(detectFace);
      return;
    }

    ctx.clearRect(0, 0, overlay.width, overlay.height);

    const detections = await faceapi.detectAllFaces(
      video,
      new faceapi.TinyFaceDetectorOptions({ minConfidence: 0.5 })
    ).withFaceLandmarks();

    detections.forEach(det => {
      const { x, y, width, height } = det.box;
      if (currentFilter === 'cat') {
        drawImage('https://i.ibb.co/ScwZf6M/cat-ears.png', x - 10, y - 50, width + 20, 50);
      }
      if (currentFilter === 'glasses') {
        drawImage('https://i.ibb.co/ZG1V1Pv/glasses.png', x, y + height * 0.35, width, height * 0.3);
      }
    });

    animationId = requestAnimationFrame(detectFace);
  }

  function drawImage(src, x, y, w, h) {
    const img = new Image();
    img.src = src;
    img.onload = () => ctx.drawImage(img, x, y, w, h);
  }

  // === Efek Bintang Jatuh ===
  function createShootingStar() {
    const star = document.createElement("div");
    star.classList.add("shooting-star");
    
    const startX = Math.random() * 100;
    const endX = startX + (Math.random() > 0.5 ? 20 : -20);
    const duration = 2 + Math.random() * 3;

    star.style.left = `${startX}%`;
    star.style.animation = `fall ${duration}s linear forwards`;

    document.body.appendChild(star);

    // Animasi bintang
    const style = document.createElement('style');
    style.textContent = `
      @keyframes fall {
        0% { transform: translateY(0) rotate(0deg); opacity: 0; }
        20% { opacity: 1; }
        80% { opacity: 1; }
        100% { transform: translateX(${endX}px) translateY(120vh) rotate(200deg); opacity: 0; }
      }
    `;
    document.head.appendChild(style);

    setTimeout(() => {
      document.body.removeChild(star);
      document.head.removeChild(style);
    }, duration * 1000);
  }

  // Jatuhkan bintang setiap 1-3 detik
  setInterval(createShootingStar, 1500);

  // Muat model face-api setelah halaman siap
  window.addEventListener("load", () => {
    Promise.all([
      faceapi.nets.tinyFaceDetector.loadFromUri('https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/weights'),
    ]).then(() => {
      console.log("Model face-api.js dimuat.");
    }).catch(err => {
      console.error("Gagal muat model:", err);
      alert("Gagal memuat model deteksi wajah.");
    });
  });
</script>
</body>
</html>